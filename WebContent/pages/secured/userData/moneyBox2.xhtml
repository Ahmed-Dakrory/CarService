<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/publicTemplateWithMenu.xhtml">



	<ui:define name="content">
	
	 <script src="https://www.paypal.com/sdk/js?client-id=AfJLLJtGEwfl6Hye0lNyGe7Sm-OoqHu-Duhln5rwdfd9NCuldziZOsD_A8nt2zbVznmhVPJt5Qpw1ps3"></script>
	 
	 <!-- Trial
	 <script src="https://www.paypal.com/sdk/js?client-id=AYJafdGM8WMc40tom1a26q7kGrxKdqIp1eH5a-MPCMI-_oTfuWromWMsl6OpzbMaWT3HxywgJFIxtwCr"></script>
	-->
	
 <script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1"></script>
    <script src="https://js.stripe.com/v3/"></script>
  
<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css"></link>
	<div>
<div class="clearfix"></div>
#{loginBean.refresh()}
#{carBean.filterCarToGetTotalMoneyBox()}
<style>

#checkout-button {
    width: 400px;
    height: 112px;
    border-radius: 6px!important;
    justify-content: space-between;
    height: 36px;
    background: #556cd6;
    color: white;
    width: 100%;
    font-size: 14px;
    border: 0;
    font-weight: 500;
    cursor: pointer;
    letter-spacing: 0.6;
    border-radius: 0 0 6px 6px;
    transition: all 0.2s ease;
    box-shadow: 0px 4px 5.5px 0px rgb(0 0 0 / 7%);
}
button, input[type="submit"] {
    color: #333 !important;
}


.fa{

color: #161208;

}

.small, small {
    font-size: 80%;
    font-weight: 900;
    color: #161208;
}
</style>
<p:panel id="aspnetForm">
<div class="account-table row">



<div  style="border-radius: 7px;box-shadow: 2px 0px 1px #b9b9b9, 0 0 21px #ffffff, 0 0 3px #733838;text-align: right;">

<div class=" bootstrap snippets bootdey" >
  <div class="row">
      <div class="col-md-12">
      <div class="">
      <div class="panel-body">
                  <div class="row">
                        <div class="col-xs-12 col-sm-8">
                            <h2 class="text-primary"><b><span class="fa fa-money"></span> مرحبا #{loginBean.theUserOfThisAccount.firstName} #{loginBean.theUserOfThisAccount.lastName} عميل رقم ##{loginBean.theUserOfThisAccount.id} </b></h2>
                            <div class="container">
                            	<div class="row">
                            		 <div class="col-xs-12 col-sm-4">
			                            <h4 style="text-align: center;"><strong> $#{loginBean.thisAccountMoneyBox.depositedMoney} </strong></h4>                    
			                            <p class="btn btn-success btn-block"><span class="fa fa-dollar"></span><small>المودع</small></p>
			                        </div><!--/col-->
			                        <div class="col-xs-12 col-sm-4">
			                            <h4 style="text-align: center;"><strong>$#{loginBean.thisAccountMoneyBox.totalUsed}</strong></h4>                    
			                            <p class="btn btn-info btn-block"><span class="fa fa-dollar"></span><small>المستخدم</small></p>
			                        </div><!--/col-->
			                        <div class="col-xs-12 col-sm-4">
			                            <h4 style="text-align: center;"><strong>$#{carBean.totalPrice}</strong></h4>                    
			                            <p class="btn btn-info btn-block"><span class="fa fa-dollar"></span><small>التكلفة الكلية</small></p>
			                        </div><!--/col-->
			                       
                            	</div>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-4">
                        	<p style="font-size: 25px;font-family: serif;text-align: center;margin-top: 26px;"> حسابك #{loginBean.thisAccountMoneyBox.active?'فعال':'غير فعال'}</p>
			  				<p style="  display:#{loginBean.thisAccountMoneyBox.active?'none':'contents'};   text-shadow: 1px 1px 2px white, 0 0 25px white, 0 0 5px #cacaca;">لتفعيل حسابك برجاء ارسال ايميل لنا</p>
	                        <div style="    text-align: center;">
	                        	<p:graphicImage style="    width: 151px;" value="/resources/imgs/#{loginBean.thisAccountMoneyBox.active?'correct':'error'}.png"></p:graphicImage>
		  		            </div>
	                        
		  					<!-- <p:commandButton rendered="#{!loginBean.thisAccountMoneyBox.active}" disabled="#{loginBean.thisAccountMoneyBox.active}" class="btn btn-default DTTT_button_print" value="Activate the account" action="#{loginBean.activateMyAccount}"/>
	  							 -->
                        </div>

                       <!--/col-->
                  </div><!--/row-->
                  
                  <div class="row">
                  	
<div id="ajax-content">

<div class="sort-boxes-account">


<h:form > 
	  
	   <div class="container content-table" >
            	<div class="row">
            	
            		<div class="col-md-6 mb-3">
						<div class="form-group">
						    <label >اسم البنك</label>
						    <h:inputText value="#{loginBean.thisAccountMoneyBox.bankName}" class="form-control"   type="text"   />
						</div>
  
                   </div>
                   
                   
                   <div class="col-md-6 mb-3">
						<div class="form-group">
						    <label >رقم حساب البنك</label>
						    <h:inputText value="#{loginBean.thisAccountMoneyBox.bankAccountNumber}" class="form-control"   type="text"   />
						</div>
  
                   </div>
                   
                   
                    <div class="col-md-6 mb-3">
						<div class="form-group">
						    <label >عنوان البنك</label>
						    <h:inputText value="#{loginBean.thisAccountMoneyBox.bankAddress}" class="form-control"   type="text"   />
						</div>
  
                   </div>
                   
                   
                    <div class="col-md-6 mb-3">
						<div class="form-group">
						    <label >رقم هاتف الخاص بالبنك</label>
						    <h:inputText value="#{loginBean.thisAccountMoneyBox.bankTelephone}" class="form-control"   type="text"   />
						</div>
  
                   </div>
                   
              </div>
              
              <div class="row">
	            	<div class="col-md-6 mb-3">
							<div class="form-group">
							    <h:commandButton  actionListener="#{loginBean.saveBankAccountDetails}" class="btn btn-primary" value="حفظ" id="ctl00_BodyHolder_cmdSave" style="font-family:Verdana;font-size:10px;font-weight:bold;height:31px;width:100px; color:white!important;" >
							    <f:ajax execute="@form" render="@form" />
							    </h:commandButton>
							</div>
	  
	                   </div>
                   </div>
                   
              <div class="row" style="text-align: center;">
              
              		<p:panel id="amountTopay">
	  				<p class="BankHead">الكمية المراد دفعها بدون كسور</p>
		  			<p:inputText  value="#{loginBean.amountToPayThroughPayPal}"  class="textBoxStyle"/>
		  			<br></br>
		  			<br></br>
		  			<p:commandButton value = "اضغط هنا قبل الدفع" update="amountTopay"></p:commandButton>	
		  			<br></br>
		  			<br></br>
		  			
		  			<p:outputLabel value="سوف تدفع  #{loginBean.amountToPayThroughPayPal}"></p:outputLabel>
		  			
		  			<div class="container">
		  				<div class="row">
		  					<div class="col-md-7">
		  						<div id="paypal-button-container" />
		  			
		  					</div>
		  					<div class="col-md-5">
	  		
							      <button type="button" id="checkout-button">ادفع ب  Stripe</button>
							   
		  					</div>
		  				</div>
		  			</div>
		  			
		  			 <script type="text/javascript">
    // Create an instance of the Stripe object with your publishable API key
    var stripe = Stripe("pk_live_xQs5sGcXeb1hjN9kMmqiaomk");
    var checkoutButton = document.getElementById("checkout-button");

    checkoutButton.addEventListener("click", function () {
      fetch("https://caromotolibya.com/rest/Api/stripe?price=#{loginBean.amountToPayThroughPayPal}&amp;name=CaroMoto Services&amp;moneyBoxId=#{loginBean.thisAccountMoneyBox.id}&amp;amount=#{loginBean.amountToPayThroughPayPal}&amp;type=", {
        method: "GET",
      })
        .then(function (response) {
        	console.log("Done1");
          return response.json();
        })
        .then(function (session) {
        	console.log("Done2");
          return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function (result) {
        	console.log("Done3");
          // If redirectToCheckout fails due to a browser or network
          // error, you should display the localized error message to your
          // customer using error.message.
          if (result.error) {
            alert(result.error.message);
          }
        })
        .catch(function (error) {
          console.error("Error:", error);
        });
    });
  </script>
  
						  			
				     <script>
				paypal.Buttons({
				    createOrder: function(data, actions) {
				      return actions.order.create({
				        purchase_units: [{
						
							description: 'Test description',
				            amount: {
				                currency_code: "USD",
				                value: '#{loginBean.amountToPayThroughPayPal}'
				             }
				          }]
				      });
				    },
				    onApprove: function(data, actions) {
				      return actions.order.capture().then(function(details) {
				    	  //activateMyAccount
				        
				        var amount=#{loginBean.amountToPayThroughPayPal};
						updatePayment([{name: 'paymentAmount', value: amount}, {name: 'data', value: 'NOTHING'}]);
						
				        // Call your server to save the transaction
				        
				      });
				    },
				          onError: function( err){
				        	  
				            console.log(err);
				          }
				  }).render('#paypal-button-container');
				</script>
	  			</p:panel>
	  		
              </div>
          </div>
                   
	  
	  
	   <p:remoteCommand name="updatePayment" action="#{loginBean.addThisAmountToMyAccount}"/>
        </h:form>




</div>
<div class="clr"></div>

</div>
                  </div>
              </div><!--/panel-body-->
          </div><!--/panel-->
    </div>
  </div>
</div>        
          


</div>
</div>
<img id="ajax-loader-account" src="/img/ajax-loader.gif" alt="Please Wait"/>
</p:panel>
</div>
	
	  
     
     
     
     
     
     <script>

 	$('#menu-header-profile').toggleClass('expand');
 	$('#menu-profile').fadeToggle();
 	$('#profile-transaction').toggleClass('menu-item-refunds');
     </script>
     
     
     
	</ui:define>
	
		
	
</ui:composition>
</html>
